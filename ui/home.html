<h1>Bienvenido a la pagina inicial</h1>
<p><a class="form_inicio_registro" id="iniciof" href="#">Iniciar Sesion</a></p>
<p><a class="form_inicio_registro" id="registrof" href="#">Registrarse</a></p>

<div id="content"></div>


<div id='info_evento_home' style='transition: 2s;height:0px;'>
	<div id='datos_reporte_home' style='display:none;' ></div>
	<img src='/ui/images/loading.GIF' style='display:none;' />
	<span id='cerrar_datos_reporte_home' style='display:none;'>Cerrar</span>
</div>

<div id="map" style="height:380px;"></div>

<script type="text/javascript">

$(document).ready(function(){


 /*Codigo javascript para refrescar la seccion principal "content" para mostrar el formulario de registro/inicio de sesion */
	$(".form_inicio_registro").click(function(){
		 $.ajax({
			type: 'POST',
			url: '/login', 
			}).done(function(html){
				$( "#content" ).html( html );
			});
	});

//Se declara un arreglo vacio de elementos para guardar todos los markers
var eventosrecientes = [];

	<repeat group="{{ @eventosrecientes }}" key="{{ @k }}" value="{{ @evento }}">
	eventosrecientes[{{ @k }}]=[];
		<repeat group="{{ @evento }}" key = "{{ @key }}" value="{{ @atributo }}">
			 eventosrecientes[{{ @k }}]["{{ @key }}"] = "{{ @atributo }}";
		</repeat>
	</repeat>

//alert(eventosrecientes[0]["firtsName"]);
//alert(eventosrecientes["eventos"][0]["idEvento"]);


	//Se inicializa el mapa para mostrarlo en una posicion generica para que se vea latinoamerica
	var map = null;
	var osmUrl = 'http://{s}.tile.osm.org/{z}/{x}/{y}.png',
							osmAttribution = '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
							osm = new L.TileLayer(osmUrl, {maxZoom: 18, attribution: osmAttribution});
				
	var mapLayer = new L.TileLayer(osmUrl);
	
	map = new L.Map('map').setView([ 14.216108846888353, -81.123046875], 5);;
	map.addLayer(mapLayer);
	
	//Se obtiene la posicion del usuario desde el navegador y se coloca el mapa en ese punto
	map.locate({setView : true, maxZoom : 15});
	
	//Se deben agregar los ultimos 10 eventos en markers 

	//alert(eventosrecientes[0]["lat"]);
	
	var evento = [];
	var index;

	for (index = 0; index < eventosrecientes.length; ++index) {

	//Se crea una instancia del indice para que este dentro del contexto de la variable	
	var i = index;
	//Se crea un marker para indicar los eventos encontrados, se le agrega el titulo del tipo de evento y la enfermedad y se agrega un on clic para mostrar el div con la informacion del evento
	/*evento[index] = L.marker([eventosrecientes[index]["lat"], eventosrecientes[index]["lon"]],{ title: eventosrecientes[index]["categoriaName"]+': '+eventosrecientes[index]["name"] }).addTo(map).on('click', function(){ 
			$('#info_evento_home').html(eventosrecientes[i]["name"] );
		 } );*/

evento[index] = L.marker([eventosrecientes[index]["lat"], eventosrecientes[index]["lon"]],{ title: eventosrecientes[index]["categoriaName"]+': '+eventosrecientes[index]["name"] }).addTo(map);
		
evento[index].indice = index;


	}
	for(var j = 0; j < eventosrecientes.length; j++){
	
	evento[j].on('click', function(){ 

		/* Datos originales
		"
		
			<ul>
			     	<li><span class='titulo_dato_home'>Tipo de reporte:<span> "+eventosrecientes[this.indice]['categoriaName']+"</li>
				<li><span class='titulo_dato_home'>Enfermedad:<span> "+eventosrecientes[this.indice]['name']+"</li>
				<li><span class='titulo_dato_home'>Usuario que Reporta:<span> "+eventosrecientes[this.indice]['alias']+"</li>
				<li><span class='titulo_dato_home'>Reportado el:<span> "+eventosrecientes[this.indice]['created_at']+"</li>
			</ul>
		"

		*/
		var contenido =  "<ul><li><span class='titulo_dato_home'>Tipo de reporte:<span> "+eventosrecientes[this.indice]['categoriaName']+"</li><li><span class='titulo_dato_home'>Enfermedad:<span> "+eventosrecientes[this.indice]['name']+"</li><li><span class='titulo_dato_home'>Usuario que Reporta:<span> "+eventosrecientes[this.indice]['alias']+"</li><li><span class='titulo_dato_home'>Reportado el:<span> "+eventosrecientes[this.indice]['created_at']+"</li></ul>";
			/*$('#info_evento_home img').fadeIn();*/
			$('#info_evento_home').css('height','135px');
			$('#cerrar_datos_reporte_home').fadeIn('slow');
			$('#datos_reporte_home').html(contenido);
			$('#datos_reporte_home').fadeIn('slow');
		 } );

	}


	
});

</script>

<script type="text/javascript" src='/ui/js/funcioneshome.js' ></script>



